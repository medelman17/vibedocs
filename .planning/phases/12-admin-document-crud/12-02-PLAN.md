---
phase: 12-admin-document-crud
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - app/(main)/(admin)/admin/page.tsx
  - app/(main)/(admin)/admin/loading.tsx
  - app/(main)/(admin)/admin/columns.tsx
  - app/(main)/(admin)/admin/documents-table.tsx
  - app/(main)/(admin)/admin/toolbar.tsx
autonomous: true

must_haves:
  truths:
    - "Admin page lists all org documents in a data table with sortable columns"
    - "Table shows name, upload date, status, and file type columns per locked decision"
    - "Table has checkbox column for row selection (bulk operations)"
    - "Search bar filters documents by title"
    - "Filter dropdowns for status, file type, and date range"
    - "Traditional numbered pagination with page size selector"
    - "Sorting is server-side (not just client-side current page)"
    - "All state (page, search, filters, sort) stored in URL search params"
  artifacts:
    - path: "app/(main)/(admin)/admin/page.tsx"
      provides: "Admin page RSC with data fetching via searchParams"
      contains: "adminGetDocuments"
    - path: "app/(main)/(admin)/admin/columns.tsx"
      provides: "TanStack Table column definitions"
      contains: "ColumnDef"
    - path: "app/(main)/(admin)/admin/documents-table.tsx"
      provides: "Client component rendering TanStack Table with shadcn Table primitives"
      contains: "useReactTable"
    - path: "app/(main)/(admin)/admin/toolbar.tsx"
      provides: "Search bar and filter dropdowns"
      contains: "Input"
    - path: "app/(main)/(admin)/admin/loading.tsx"
      provides: "Loading skeleton for the data table"
      contains: "Skeleton"
  key_links:
    - from: "app/(main)/(admin)/admin/page.tsx"
      to: "app/(main)/(admin)/admin/actions.ts"
      via: "adminGetDocuments call"
      pattern: "adminGetDocuments"
    - from: "app/(main)/(admin)/admin/documents-table.tsx"
      to: "app/(main)/(admin)/admin/columns.tsx"
      via: "columns import"
      pattern: "columns"
    - from: "app/(main)/(admin)/admin/toolbar.tsx"
      to: "URL search params"
      via: "useRouter + useSearchParams for filter state"
      pattern: "useSearchParams"
---

<objective>
Build the admin documents data table with TanStack React Table, server-side pagination, sorting, filtering, and search.

Purpose: This is the primary admin UI -- a data table listing all org documents with full interactive controls. Uses URL search params for all state so the page is shareable and bookmarkable. TanStack Table runs in manual mode (server-side pagination/sorting/filtering).

Output: Admin page with a functional data table showing documents with sorting, search, filter dropdowns, pagination, and row selection.
</objective>

<execution_context>
@/Users/medelman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/medelman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-admin-document-crud/12-CONTEXT.md
@.planning/phases/12-admin-document-crud/12-RESEARCH.md
@.planning/phases/12-admin-document-crud/12-01-SUMMARY.md

@app/(main)/(admin)/admin/actions.ts
@components/ui/table.tsx
@components/ui/checkbox.tsx
@components/ui/badge.tsx
@components/ui/pagination.tsx
@components/ui/select.tsx
@components/ui/input.tsx
@components/ui/skeleton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Column definitions and documents table client component</name>
  <files>
    app/(main)/(admin)/admin/columns.tsx
    app/(main)/(admin)/admin/documents-table.tsx
  </files>
  <action>
**Column definitions** (`app/(main)/(admin)/admin/columns.tsx`):

Create column definitions using `ColumnDef` from `@tanstack/react-table`. This is a "use client" file.

Columns (per locked decision "Essential columns: name, upload date, status, file type"):

1. **select** - Checkbox column for row selection (per locked decision "Bulk delete supported -- select multiple documents via checkboxes")
   - Header: `<Checkbox>` that toggles all page rows
   - Cell: `<Checkbox>` that toggles individual row
   - `enableSorting: false, enableHiding: false`

2. **title** - Document name
   - Header: "Name" (sortable)
   - Cell: truncate to ~60 chars with tooltip on overflow, use `font-medium`

3. **createdAt** - Upload date
   - Header: "Upload Date" (sortable)
   - Cell: format with `Intl.DateTimeFormat('en-US', { month: 'short', day: 'numeric', year: 'numeric' })` -- e.g., "Feb 5, 2026"

4. **status** - Processing status
   - Header: "Status" (sortable)
   - Cell: `<Badge>` with variant mapped from status:
     - "pending" -> default variant, "Pending"
     - "parsing"/"embedding"/"analyzing" -> secondary variant, "Processing"
     - "ready"/"complete" -> outline + green text, "Complete"
     - "failed" -> destructive variant, "Failed"
     - "cancelled" -> secondary variant, "Cancelled"

5. **fileType** - File type
   - Header: "Type" (sortable)
   - Cell: format MIME type to human-readable: "application/pdf" -> "PDF", DOCX mime -> "DOCX"

6. **fileSize** - File size
   - Header: "Size" (sortable)
   - Cell: format bytes to human-readable: `(bytes / 1024 / 1024).toFixed(1) + " MB"` or KB for small files

Import `Checkbox` from `@/components/ui/checkbox`, `Badge` from `@/components/ui/badge`.

The column definition type should be: `ColumnDef<AdminDocument>[]` where `AdminDocument` is a type matching the document shape returned from `adminGetDocuments`. Export the type from columns.tsx.

**Documents table** (`app/(main)/(admin)/admin/documents-table.tsx`):

"use client" component that renders the TanStack Table using shadcn Table primitives.

Props:
```typescript
interface DocumentsTableProps {
  data: AdminDocument[]
  total: number
  page: number
  pageSize: number
  sortBy?: string
  sortOrder?: "asc" | "desc"
  onRowClick: (documentId: string) => void
}
```

Implementation:
- Use `useReactTable` with:
  - `data` and `columns` from columns.tsx
  - `manualPagination: true` (server-side pagination per research pitfall 4)
  - `manualSorting: true` (server-side sorting per research pitfall 4)
  - `pageCount: Math.ceil(total / pageSize)`
  - `getCoreRowModel()`, `getSortedRowModel()`, `getFilteredRowModel()`
  - `enableRowSelection: true`
  - `state: { sorting, rowSelection, pagination: { pageIndex: page - 1, pageSize } }`
  - `onSortingChange` and `onRowSelectionChange` handlers

- Render using shadcn Table components: `<Table>`, `<TableHeader>`, `<TableRow>`, `<TableHead>`, `<TableBody>`, `<TableCell>`
- flexRender for header and cell content
- Row click handler: `onClick={() => onRowClick(row.original.id)}` with cursor-pointer styling. Per locked decision: "Clicking a document row opens a detail panel."
- Exclude checkbox column click from row click (stopPropagation on checkbox cell)

- Sorting: When user clicks sortable column header, update URL search params with `sortBy` and `sortOrder` using `useRouter().replace()`. Use arrow icons (ChevronUp/ChevronDown from lucide-react) to indicate sort direction.

- Row selection: Track via TanStack Table's built-in row selection state. Export selected row IDs for bulk delete (used by toolbar).

- Pagination section at bottom:
  - Left: "Showing X-Y of Z documents" text, plus "{N} selected" when rows selected
  - Center: Numbered page buttons using shadcn `Pagination`, `PaginationContent`, `PaginationItem`, `PaginationLink`, `PaginationPrevious`, `PaginationNext`, `PaginationEllipsis`. Show current page, first, last, and 1-2 pages around current.
  - Right: Page size selector using shadcn `Select` with options [10, 20, 50, 100]

- All pagination/sort changes update URL search params via `useRouter().replace()` with `useSearchParams()` to preserve existing params.

- Empty state: When data.length === 0 and no filters active, show centered message "No documents yet. Upload your first NDA to get started." with a subtle file icon. When filters active but no results, show "No documents match your filters."
  </action>
  <verify>
TypeScript compiles: `cd /Users/medelman/GitHub/medelman17/vibedocs && npx tsc --noEmit --pretty 2>&1 | head -50`
  </verify>
  <done>
Column definitions define select, name, upload date, status, file type, and size columns. Documents table renders with TanStack Table in manual mode, with server-side sort via URL params, row selection, numbered pagination, and page size selector.
  </done>
</task>

<task type="auto">
  <name>Task 2: Toolbar, loading skeleton, and admin page RSC</name>
  <files>
    app/(main)/(admin)/admin/toolbar.tsx
    app/(main)/(admin)/admin/loading.tsx
    app/(main)/(admin)/admin/page.tsx
  </files>
  <action>
**Toolbar** (`app/(main)/(admin)/admin/toolbar.tsx`):

"use client" component with search bar and filter dropdowns.

Props:
```typescript
interface ToolbarProps {
  selectedCount: number
  onBulkDelete: () => void
}
```

Layout: flex row with gap-2, items-center.

1. **Search bar**: shadcn `Input` with SearchIcon, placeholder "Search documents..."
   - Debounce input (300ms) using a local `useState` + `useEffect` with setTimeout
   - On debounced change, update URL search params: set `search` param, reset `page` to 1
   - Read initial value from `useSearchParams().get("search")`

2. **Status filter**: shadcn `Select` with options:
   - "All statuses" (value: empty string, clears filter)
   - "Pending", "Processing", "Complete", "Failed", "Cancelled"
   - On change, update URL search params: set `status` param, reset `page` to 1

3. **File type filter**: shadcn `Select` with options:
   - "All types" (value: empty string)
   - "PDF", "DOCX"
   - On change, update URL search params: set `fileType` param (use MIME type values), reset page

4. **Date range filter**: shadcn `Select` with preset ranges (per research recommendation):
   - "All time" (value: empty string)
   - "Last 7 days" (value: "7d")
   - "Last 30 days" (value: "30d")
   - "Last 90 days" (value: "90d")
   - On change, update URL search params: set `dateRange` param, reset page

5. **Bulk delete button**: Shown only when `selectedCount > 0`. shadcn `Button` variant="destructive" with Trash2 icon. Text: "Delete (N)". Calls `onBulkDelete`.

All filter changes use `useRouter().replace()` with `useSearchParams()` to update URL params without navigation.

**Loading skeleton** (`app/(main)/(admin)/admin/loading.tsx`):

Server component that renders a table skeleton:
- Header with title "Documents" skeleton
- Toolbar skeleton (search input + 3 select placeholders)
- Table skeleton: 5-6 rows with `<Skeleton>` cells matching column widths

**Admin page** (`app/(main)/(admin)/admin/page.tsx`):

Server component (RSC) that:
1. Reads URL search params (Next.js 16 pattern: `searchParams` is a Promise):
```typescript
export default async function AdminDocumentsPage({
  searchParams,
}: {
  searchParams: Promise<Record<string, string | string[] | undefined>>
}) {
  const params = await searchParams
  const page = parseInt(String(params.page ?? "1"), 10)
  const pageSize = parseInt(String(params.size ?? "20"), 10)
  const search = params.search ? String(params.search) : undefined
  const status = params.status ? String(params.status) : undefined
  const fileType = params.fileType ? String(params.fileType) : undefined
  const dateRange = params.dateRange ? String(params.dateRange) : undefined
  const sortBy = params.sortBy ? String(params.sortBy) : undefined
  const sortOrder = (params.sortOrder === "asc" ? "asc" : "desc") as "asc" | "desc"
```

2. Calls `adminGetDocuments()` with extracted params
3. Renders page header: `<h1>` "Documents" + document count badge
4. Renders `<Toolbar>` and `<DocumentsTable>` with fetched data
5. Handles error state: if `!result.success`, show error alert

The page uses Tailwind classes consistent with the rest of the app: `p-6` padding, `space-y-4` vertical spacing.
  </action>
  <verify>
Build succeeds: `cd /Users/medelman/GitHub/medelman17/vibedocs && pnpm build 2>&1 | tail -20`

Alternatively if build takes too long: `npx tsc --noEmit --pretty 2>&1 | head -50`
  </verify>
  <done>
Admin page renders a data table with server-side data fetching via URL search params. Toolbar provides search, status filter, file type filter, date range filter, and bulk delete button. Loading skeleton shows during page transitions. Traditional numbered pagination with page size selector works.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` shows no type errors
2. Admin page at `/admin` renders a data table (verify via build success or dev server)
3. URL search params drive pagination, search, and filtering
4. Table has checkbox column, name, upload date, status, type, and size columns
5. Pagination shows numbered pages with page size selector
</verification>

<success_criteria>
- Data table renders with all required columns (select, name, date, status, type, size)
- Sorting updates URL params and re-fetches from server
- Search debounces and filters by title
- Filter dropdowns for status, file type, date range all update URL params
- Pagination shows numbered pages, page size selector, and "X of Y" count
- Row selection via checkboxes works for bulk operations
- Empty states render appropriately
- Loading skeleton displays during data fetching
</success_criteria>

<output>
After completion, create `.planning/phases/12-admin-document-crud/12-02-SUMMARY.md`
</output>
